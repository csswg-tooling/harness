<?php
////////////////////////////////////////////////////////////////////////////////
//
//  Copyright © 2007 World Wide Web Consortium, 
//  (Massachusetts Institute of Technology, European Research 
//  Consortium for Informatics and Mathematics, Keio 
//  University). All Rights Reserved. 
//  Copyright © 2008 Hewlett-Packard Development Company, L.P. 
// 
//  This work is distributed under the W3CÂ Software License 
//  [1] in the hope that it will be useful, but WITHOUT ANY 
//  WARRANTY; without even the implied warranty of 
//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. 
// 
//  [1] http://www.w3.org/Consortium/Legal/2002/copyright-software-20021231 
//
//////////////////////////////////////////////////////////////////////////////// 

//////////////////////////////////////////////////////////////////////////////// 
//
//  class.test_cases.php
//
//  Adapted from Mobile Test Harness [1]
//
//    File: tests.php
//      Class: TestSuite
//      Lines: 246-344
//
//  where herein obtaining a list of available test cases in a particular
//  test suite is queried from the database and stored internally.
//  Other information queries (e.g. obtaining the indentity of the next
//  test case in a particular progression of test cases) are deferred to 
//  other object classes.
//
// [1] http://dev.w3.org/cvsweb/2007/mobile-test-harness/
//
//////////////////////////////////////////////////////////////////////////////// 

require_once("./lib_test_harness/class.db_connection.phi");

////////////////////////////////////////////////////////////////////////////////
//
//  class test_cases
//
//  test_cases is a concrete db_connection taylored for storing the 
//  table of contents of available test cases in a particular test suite.
//
////////////////////////////////////////////////////////////////////////////////
class test_cases extends db_connection
{
  ////////////////////////////////////////////////////////////////////////////
  //
  //  Instance variables.
  //
  ////////////////////////////////////////////////////////////////////////////
  var $m_toc;

  ////////////////////////////////////////////////////////////////////////////
  //
  //  get_count
  //
  //  Return the number of test cases available.
  //
  ////////////////////////////////////////////////////////////////////////////
  function get_count()
  {
    return count($this->m_toc);
  }

  ////////////////////////////////////////////////////////////////////////////
  //
  //  Constructor
  //
  //  Query the database for a list of available test cases in a particular
  //  test suite, including information about each case as required for 
  //  generating a desired human readable listings.
  //
  ////////////////////////////////////////////////////////////////////////////
  function test_cases($test_suite) 
  {
    parent::db_connection();
    
    $sql  = "SELECT * FROM testcases ";
    $sql .= "WHERE testsuite='$test_suite' ";
    $sql .= "AND active='1'";
    
    $r = $this->query($sql);

    if($r->is_false()) {
      $msg = 'Unable to obtain list of test cases.';
      trigger_error($msg, E_USER_ERROR);
    }

    $this->m_toc = $r->fetch_table();

    if(!($this->m_toc)) {
      $msg = 'Unable to obtain list of test cases.';
      trigger_error($msg, E_USER_ERROR);
    }
  }

  ////////////////////////////////////////////////////////////////////////////
  //
  //  write
  //
  //  Write HTML for a drop down selection listing of available test cases.
  //
  ////////////////////////////////////////////////////////////////////////////
  function write($indent)
  {
    echo $indent . '<select name="c" style="width: 25em">' ."\n";

    foreach($this->m_toc as $test_case) {
      echo $indent . '  <option value="';
      echo $test_case['testcase'];
      echo '">';
      echo $test_case['title'];
      echo '</option>' ."\n";
    }
    echo $indent . '</select>' . "\n";
  }

}

?>